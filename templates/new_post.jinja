{% extends "base.jinja" %}

{% block head %}
<link rel="stylesheet" type="text/css" href="https://unpkg.com/pell/dist/pell.min.css">
{% endblock %}

{% block title %}New Blog Entry{% endblock %}

{% block content %}


<form class="flex flex-col gap-4" action="{{ url_for('new_post') }}" method="POST">
    <input type="text" name="title" placeholder="Title" required>
    <input type="hidden" name="topic" id="topic" value="default" />
    <select id="topic-select" required>
        <option value="default" selected="true">Default</option>
        {% for topic in topics %}
        <option value="{{ topic }}">{{ topic }}</option>
        {% endfor %}
        <option value="other">Other</option>
    </select>
    <input class="hidden" type="text" id="topic-text" />
    <div id="editor" class="pell bg-white"></div>
    <input type="hidden" name="content" id="content">
    <button type="submit">Submit</button>
</form>

{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/pell"></script>
<script type="module">
    // Initialize pell on an HTMLElement
    pell.init({
        // <HTMLElement>, required
        element: document.getElementById('editor'),

        // <Function>, required
        // Use the output html, triggered by element's `oninput` event
        onChange: html => document.getElementById('content').value = html,
    })

    document.getElementById('topic-select').addEventListener('change', function (event) {
        if (event.target.value === 'other') {
            document.getElementById('topic-text').classList.remove('hidden');
        } else {
            document.getElementById('topic-text').classList.add('hidden');
            document.getElementById('topic').value = event.target.value;
        }
    });

    document.getElementById('topic-text').addEventListener('change', function (event) {
        document.getElementById('topic').value = event.target.value;
    });
</script>
{% endblock %}