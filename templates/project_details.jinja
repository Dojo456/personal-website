{% extends "base.jinja" %}

{% block head %}
<link rel="stylesheet" type="text/css" href="https://unpkg.com/pell/dist/pell.min.css">
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="mb-8 ">
        <h1 class="text-3xl font-bold mb-2">{{ project_name }}</h1>

        <div class="flex justify-between">
            <a href="{{ url_for('projects') }}" class="text-blue-500 hover:text-blue-700">
                ‚Üê Back to Projects
            </a>
            {% if current_user.is_authenticated %}
            <button id="edit-button" class="ml-4 bg-blue-500 text-white px-4 py-2 rounded">Edit README</button>
            {% endif %}
        </div>
    </div>

    <div id="view-mode" class="prose prose-lg max-w-none">
        {{ readme_content | safe }}
    </div>

    {% if current_user.is_authenticated %}

    <div id="edit-mode" class="hidden">
        <div id="editor" class="pell bg-white"></div>
        <form method="POST" class="mt-4 flex gap-2">
            <input type="hidden" id="content" name="content">
            <input type="hidden" id="sha" name="sha" value="{{ sha }}">
            <button type="submit" id="save-button" class="bg-green-500 text-white px-4 py-2 rounded">Save</button>
            <button id="cancel-button" class="bg-gray-500 text-white px-4 py-2 rounded">Cancel</button>
        </form>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
{% if current_user.is_authenticated %}
<script src="https://unpkg.com/pell"></script>
<script>
    const viewMode = document.getElementById('view-mode');
    const editMode = document.getElementById('edit-mode');
    const editButton = document.getElementById('edit-button');
    const saveButton = document.getElementById('save-button');
    const cancelButton = document.getElementById('cancel-button');
    const content = document.getElementById('content');

    const initialContent = `{{ readme_content | safe }}`;

    const editor = pell.init({
        element: document.getElementById('editor'),
        onChange: html => content.value = html,
    });

    editButton.addEventListener('click', () => {
        editor.content.innerHTML = initialContent;

        viewMode.classList.add('hidden');
        editMode.classList.remove('hidden');
    });

    cancelButton.addEventListener('click', () => {
        viewMode.classList.remove('hidden');
        editMode.classList.add('hidden');
    });
</script>
{% endif %}
{% endblock %}